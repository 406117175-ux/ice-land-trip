<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å†°å³¶è‡ªé§•åŠ©ç† 2026 (é›¢ç·šç‰ˆ)</title>
    <style>
        :root {
            --primary: #004d99; /* å†°å³¶æ·±è— */
            --secondary: #e63946; /* è­¦å‘Š/å¼·èª¿ç´… */
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #2b2d42;
            --text-sub: #8d99ae;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: var(--bg); color: var(--text-main); margin: 0; padding-bottom: 90px; }

        /* å°èˆªåˆ— */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; height: 70px;
            background: rgba(255, 255, 255, 0.98); border-top: 1px solid #eee;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000; box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        .nav-item { text-align: center; flex: 1; color: #aaa; font-size: 11px; cursor: pointer; padding: 5px 0; }
        .nav-item.active { color: var(--primary); font-weight: 700; }
        .nav-item i { font-size: 22px; display: block; margin-bottom: 4px; font-style: normal; }

        /* é é¢å®¹å™¨ */
        .page { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* é ‚éƒ¨è³‡è¨Šå¡ */
        .info-card {
            background: var(--card-bg); border-radius: 16px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        }
        .info-card h2 { margin: 0 0 10px 0; font-size: 20px; color: var(--primary); }

        /* æ—¥æœŸé¸æ“‡å™¨ */
        .day-scroller {
            display: flex; overflow-x: auto; gap: 10px; padding: 5px 20px 15px 20px;
            margin: 0 -20px; scrollbar-width: none; /* Firefox */
        }
        .day-scroller::-webkit-scrollbar { display: none; }
        .day-btn {
            background: #fff; border: 1px solid #ddd; padding: 10px 18px; border-radius: 20px;
            white-space: nowrap; font-size: 14px; font-weight: 600; color: #666;
            transition: all 0.2s; flex-shrink: 0;
        }
        .day-btn.active {
            background: var(--primary); color: #fff; border-color: var(--primary);
            box-shadow: 0 4px 10px rgba(0,77,153,0.3);
        }

        /* --- ä¿®æ”¹å¾Œï¼šç´” CSS è¦–è¦ºå¡ç‰‡æ¨£å¼ --- */
        .spot-card {
            background: var(--card-bg); border-radius: 16px; overflow: hidden;
            margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            position: relative;
        }
        
        /* å–ä»£åŸæœ¬çš„ img æ¨™ç±¤ï¼Œæ”¹ç”¨ div èƒŒæ™¯ */
        .spot-visual {
            width: 100%; height: 120px;
            display: flex; align-items: center; justify-content: center;
            font-size: 48px; position: relative;
        }
        
        /* ä¸åŒé¡å‹çš„èƒŒæ™¯æ¼¸å±¤ */
        .vis-spot { background: linear-gradient(135deg, #2a9d8f 0%, #264653 100%); }
        .vis-food { background: linear-gradient(135deg, #f4a261 0%, #e76f51 100%); }
        .vis-hotel { background: linear-gradient(135deg, #457b9d 0%, #1d3557 100%); }

        .spot-tag {
            position: absolute; top: 15px; left: 15px;
            padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; color: #fff;
            text-transform: uppercase; letter-spacing: 0.5px;
            background: rgba(0,0,0,0.3); backdrop-filter: blur(4px);
        }

        .spot-content { padding: 15px; }
        .spot-title { margin: 0 0 5px 0; font-size: 18px; font-weight: 700; color: #333; }
        .spot-desc { font-size: 14px; color: #666; line-height: 1.5; margin-bottom: 15px; }
        
        .action-row { display: flex; gap: 10px; }
        .btn {
            flex: 1; padding: 10px; border-radius: 8px; text-align: center;
            font-size: 14px; font-weight: 600; text-decoration: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 6px;
        }
        .btn-nav { background: #e8f0fe; color: #1a73e8; }
        .btn-web { background: #f1f3f4; color: #333; }
        
        /* æºé€šå¡æ¨£å¼ */
        .comm-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .comm-card {
            background: #fff; padding: 15px; border-radius: 12px; text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer;
            transition: transform 0.1s;
        }
        .comm-card:active { transform: scale(0.98); }
        .comm-icon { font-size: 30px; margin-bottom: 8px; display: block; }
        .comm-text { font-size: 14px; font-weight: 600; color: #444; }

        /* å…¨è¢å¹•è¦†è“‹å±¤ */
        .overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 2000; flex-direction: column;
            justify-content: center; align-items: center; text-align: center; color: #fff;
            padding: 20px;
        }
        .overlay-main { font-size: 40px; font-weight: 700; margin-bottom: 20px; line-height: 1.3; }
        .overlay-sub { font-size: 18px; color: #aaa; }

        /* å·¥å…·é è¼¸å…¥æ¡† */
        .input-group { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-group input { 
            flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;
        }
        .btn-add { background: var(--primary); color: white; border: none; padding: 0 20px; }

    </style>
</head>
<body>

    <!-- é é¢ 1: è¡Œç¨‹ (é è¨­é¦–é ) -->
    <section id="page-itinerary" class="page active">
        <div class="info-card" style="padding-bottom: 5px;">
            <h2>ğŸ‡®ğŸ‡¸ å†°å³¶è¡Œç¨‹ç¸½è¦½</h2>
            <div id="day-scroller" class="day-scroller">
                <!-- JS å‹•æ…‹ç”Ÿæˆ D1-D13 -->
            </div>
        </div>

        <div id="itinerary-list">
            <!-- JS å‹•æ…‹ç”Ÿæˆåœ–å¡ -->
        </div>
    </section>

    <!-- é é¢ 2: æºé€š -->
    <section id="page-comm" class="page">
        <div class="info-card">
            <h2>ğŸ—£ï¸ éš¨èº«ç¿»è­¯å®˜</h2>
            <p style="color: #666; font-size: 14px;">é»æ“Šå¡ç‰‡å¯å…¨è¢å¹•é¡¯ç¤ºï¼Œæ–¹ä¾¿çµ¦ç•¶åœ°äººçœ‹ã€‚</p>
        </div>

        <h3 style="margin-left: 5px;">ç·Šæ€¥èˆ‡é†«ç™‚</h3>
        <div class="comm-grid">
            <div class="comm-card" onclick="showFocus('Ã‰g Ã¾arf hjÃ¡lp', 'I need help (æˆ‘éœ€è¦å¹«åŠ©)')">
                <i class="comm-icon">ğŸ†˜</i>
                <div class="comm-text">æ•‘å‘½ / å¹«åŠ©</div>
            </div>
            <div class="comm-card" onclick="showFocus('Hvar er spÃ­talinn?', 'Where is the hospital?')">
                <i class="comm-icon">ğŸ¥</i>
                <div class="comm-text">é†«é™¢åœ¨å“ª</div>
            </div>
            <div class="comm-card" onclick="showFocus('Hringdu Ã­ 112', 'Call 112 please')">
                <i class="comm-icon">ğŸ“</i>
                <div class="comm-text">è«‹å¹«æ‰“ 112</div>
            </div>
            <div class="comm-card" onclick="showFocus('Ã‰g er tÃ½ndur', 'I am lost')">
                <i class="comm-icon">ğŸ§­</i>
                <div class="comm-text">æˆ‘è¿·è·¯äº†</div>
            </div>
        </div>

        <h3 style="margin-left: 5px; margin-top: 25px;">é¤å»³èˆ‡åŠ æ²¹</h3>
        <div class="comm-grid">
            <div class="comm-card" onclick="showFocus('Reikninginn, takk', 'The bill, please')">
                <i class="comm-icon">ğŸ§¾</i>
                <div class="comm-text">æˆ‘è¦è²·å–®</div>
            </div>
            <div class="comm-card" onclick="showFocus('BensÃ­n', 'Gasoline (95)')">
                <i class="comm-icon">â›½</i>
                <div class="comm-text">95 æ±½æ²¹</div>
            </div>
            <div class="comm-card" onclick="showFocus('DÃ­sel', 'Diesel')">
                <i class="comm-icon">ğŸš›</i>
                <div class="comm-text">æŸ´æ²¹</div>
            </div>
            <div class="comm-card" onclick="showFocus('Hvar er klÃ³settiÃ°?', 'Where is the toilet?')">
                <i class="comm-icon">ğŸš»</i>
                <div class="comm-text">æ´—æ‰‹é–“</div>
            </div>
        </div>
    </section>

    <!-- é é¢ 3: å·¥å…· -->
    <section id="page-tools" class="page">
        <div class="info-card">
            <h2>ğŸ› ï¸ å¯¦ç”¨å·¥å…·ç®±</h2>
            <a href="https://en.vedur.is/weather/forecasts/areas/" target="_blank" class="btn btn-nav" style="background: #e3f2fd; color: #0d47a1; margin-bottom: 10px;">
                ğŸŒ¥ï¸ æŸ¥è©¢å®˜æ–¹å¤©æ°£ (Vedur.is)
            </a>
            <a href="https://umferdin.is/en" target="_blank" class="btn btn-nav" style="background: #ffebee; color: #c62828;">
                ğŸš— æŸ¥è©¢å³æ™‚è·¯æ³ (Road.is)
            </a>
        </div>

        <div class="info-card">
            <h2>ğŸ’° å¿«é€Ÿè¨˜å¸³</h2>
            <div class="input-group">
                <input type="text" id="exp-item" placeholder="å“é … (å¦‚: ç†±ç‹—)">
                <input type="number" id="exp-cost" placeholder="é‡‘é¡ (ISK)">
                <button class="btn btn-add" onclick="addExpense()">+</button>
            </div>
            <div style="margin-top: 15px;">
                <h3 style="display:flex; justify-content:space-between;">
                    ç¸½è¨ˆ: <span id="exp-total" style="color:var(--secondary)">0</span> ISK
                </h3>
                <div id="exp-list" style="color: #666; font-size: 14px;"></div>
            </div>
            <button onclick="clearExp()" style="margin-top:15px; background:none; border:none; color:#999; text-decoration:underline;">æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>
        </div>
    </section>

    <!-- åº•éƒ¨å°è¦½åˆ— -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchPage('itinerary', this)">
            <i>ğŸ“…</i> è¡Œç¨‹
        </div>
        <div class="nav-item" onclick="switchPage('comm', this)">
            <i>ğŸ—£ï¸</i> æºé€š
        </div>
        <div class="nav-item" onclick="switchPage('tools', this)">
            <i>ğŸ› ï¸</i> å·¥å…·
        </div>
    </nav>

    <!-- å…¨è¢å¹•æºé€šè¦–çª— -->
    <div id="focus-overlay" class="overlay" onclick="this.style.display='none'">
        <div class="overlay-main" id="overlay-text-main"></div>
        <div class="overlay-sub" id="overlay-text-sub"></div>
        <div style="margin-top: 50px; font-size: 14px; opacity: 0.7;">(è¼•è§¸è¢å¹•é—œé–‰)</div>
    </div>

    <script>
        // --- 1. è³‡æ–™åº«ï¼šè©³ç´°çš„æ¯æ—¥è¡Œç¨‹èˆ‡ç²¾ç¢ºåº§æ¨™é—œéµå­— ---
        // ç§»é™¤ imgKeyï¼Œä¸å†éœ€è¦
        const itineraryDB = {
            1: [
                { type: 'hotel', title: 'æŠµé”èˆ‡å–è»Š', desc: 'æŠµé” KEF æ©Ÿå ´ï¼Œæ­ä¹˜æ¥é§è»Šå‰å¾€ LOTUS å–è»Šã€‚', query: 'Keflavik International Airport' },
                { type: 'hotel', title: 'æ©Ÿå ´å‘¨é‚Šä½å®¿', desc: 'ç¬¬ä¸€æ™šå»ºè­°æ—©é»ä¼‘æ¯ï¼Œé©æ‡‰æ™‚å·®ã€‚', query: 'Keflavik Hotel' }
            ],
            2: [
                { type: 'spot', title: 'å“ˆçˆ¾æ ¼æ—å§†æ•™å ‚', desc: 'é›·å…‹é›…ç¶­å…‹åœ°æ¨™ï¼Œå¯ç™»é ‚çœ‹å¸‚æ™¯ã€‚', query: 'Hallgrimskirkja' },
                { type: 'spot', title: 'å½©è™¹è¡—èˆ‡å¸‚å€æ¼«æ­¥', desc: 'ç¶²ç¾å¿…æ‹æ™¯é»ï¼Œé€£æ¥æ•™å ‚èˆ‡å¸‚ä¸­å¿ƒã€‚', query: 'Rainbow Street Reykjavik' },
                { type: 'food', title: 'Old Iceland', desc: 'æ™šé¤æ¨è–¦ï¼šå‚³çµ±å†°å³¶ç¾Šè‚‰æ¹¯èˆ‡é®®é­šæ–™ç†ã€‚', query: 'Old Iceland Restaurant' },
                { type: 'food', title: 'BrauÃ° & Co', desc: 'è‘—åçš„è‚‰æ¡‚æ²éºµåŒ…åº—ï¼Œæ—©é¤å¿…åƒã€‚', query: 'BrauÃ° & Co' }
            ],
            3: [
                { type: 'spot', title: 'Ytri Tunga æµ·è±¹æ²™ç˜', desc: 'é‹æ°£å¥½å¯ä»¥çœ‹åˆ°é‡ç”Ÿæµ·è±¹åœ¨å²©çŸ³ä¸Šä¼‘æ¯ã€‚', query: 'Ytri Tunga Beach' },
                { type: 'spot', title: 'BÃºÃ°akirkja é»‘æ•™å ‚', desc: 'æ–¯å¥ˆå±±åŠå³¶æ¨™èªŒæ€§çš„é»‘è‰²æœ¨é€ æ•™å ‚ã€‚', query: 'Budakirkja' },
                { type: 'spot', title: 'Arnarstapi æ¼æ‘', desc: 'å£¯è§€çš„ç„æ­¦å²©æµ·å²¸èˆ‡æµ·è•æ´ã€‚', query: 'Arnarstapi Cliff Viewpoint' },
                { type: 'hotel', title: 'StÃ¶Ã° Guesthouse', desc: 'ä»Šæ™šä½å®¿ï¼Œé™„è¨­å»šæˆ¿å¯è‡ªç…®ã€‚', query: 'StÃ¶Ã° Guesthouse and apartments' }
            ],
            4: [
                { type: 'spot', title: 'Kirkjufell æ•™å ‚å±±', desc: 'æ¬ŠåŠ›éŠæˆ²å ´æ™¯ï¼Œå†°å³¶æ”å½±è–åœ°ã€‚', query: 'Kirkjufell Mountain' },
                { type: 'spot', title: 'Kirkjufellsfoss ç€‘å¸ƒ', desc: 'æ­é…æ•™å ‚å±±çš„ç¶“å…¸å‰æ™¯ç€‘å¸ƒã€‚', query: 'Kirkjufellsfoss' },
                { type: 'food', title: 'Bjargarsteinn MathÃºs', desc: 'ä½æ–¼ GrundarfjÃ¶rÃ°ur çš„æµ·æ™¯é¤å»³ã€‚', query: 'Bjargarsteinn MathÃºs' }
            ],
            5: [
                { type: 'spot', title: 'HvÃ­tserkur çŠ€ç‰›çŸ³', desc: 'ä½æ–¼æµ·ä¸­çš„å¥‡ç‰¹å·¨å²©ï¼Œéœ€è¡Œé§›ä¸€æ®µç¢çŸ³è·¯ã€‚', query: 'HvÃ­tserkur' },
                { type: 'hotel', title: 'SiglufjÃ¶rÃ°ur', desc: 'åŒ—éƒ¨ç¾éº—çš„å³½ç£å°é®ï¼Œéå¤œé»ã€‚', query: 'SiglufjÃ¶rÃ°ur' }
            ],
            6: [
                { type: 'spot', title: 'GoÃ°afoss çœ¾ç¥ç€‘å¸ƒ', desc: 'å£¯é—Šçš„åŠåœ“å½¢ç€‘å¸ƒï¼ŒåŒ—éƒ¨å¿…è¨ªã€‚', query: 'GoÃ°afoss Waterfall' },
                { type: 'spot', title: 'Hverir åœ°ç†±è°·', desc: 'å……æ»¿ç¡«ç£ºå‘³èˆ‡æ²¸é¨°æ³¥æ¼¿çš„ç«æ˜Ÿåœ°è²Œã€‚', query: 'Hverir Myvatn' },
                { type: 'spot', title: 'ç±³æ¹–æº«æ³‰', desc: 'æ¯”è—æ¹–æ›´å¤©ç„¶æ”¾é¬†çš„æº«æ³‰é«”é©—ã€‚', query: 'MÃ½vatn Nature Baths' },
                { type: 'food', title: 'VogafjÃ³s Farm Resort', desc: 'ç‰›æ£šé¤å»³ï¼Œå¯é‚Šçœ‹ä¹³ç‰›é‚Šåƒæ¼¢å ¡ã€‚', query: 'VogafjÃ³s Farm Resort' }
            ],
            7: [
                { type: 'spot', title: 'Dettifoss é­”é¬¼ç€‘å¸ƒ', desc: 'æ­æ´²æ°´é‡æœ€å¤§çš„ç€‘å¸ƒï¼Œæ°£å‹¢é©šäººã€‚', query: 'Dettifoss West Side' },
                { type: 'spot', title: 'StuÃ°lagil Canyon', desc: 'å£¯è§€çš„ç„æ­¦å²©å³½è°·ï¼ˆç¶²ç´…æ™¯é»ï¼‰ã€‚', query: 'StuÃ°lagil Canyon' },
                { type: 'hotel', title: 'SeyÃ°isfjÃ¶rÃ°ur', desc: 'ç™½æ—¥å¤¢å†’éšªç‹æ»‘æ¿è·¯æ®µçš„å°é®ã€‚', query: 'SeyÃ°isfjÃ¶rÃ°ur' }
            ],
            8: [
                { type: 'spot', title: 'Vestrahorn è™è å±±', desc: 'å¤©ç©ºä¹‹é¡å€’å½±ï¼Œæ”å½±å¸«æœ€æ„›ã€‚', query: 'Vestrahorn' },
                { type: 'food', title: 'PakkhÃºs Restaurant', desc: 'Hofn å¿…åƒçš„å°é¾è¦å¤§é¤ã€‚', query: 'PakkhÃºs Restaurant' }
            ],
            9: [
                { type: 'spot', title: 'è—å†°æ´æ¢éšª (é›†åˆé»)', desc: 'è«‹å‹™å¿…ææ—©30åˆ†é˜æŠµé”é›†åˆé»ã€‚', query: 'JÃ¶kulsÃ¡rlÃ³n Main Parking' },
                { type: 'spot', title: 'JÃ¶kulsÃ¡rlÃ³n å†°æ²³æ¹–', desc: 'çœ‹å·¨å¤§çš„è—è‰²æµ®å†°ç·©ç·©å…¥æµ·ã€‚', query: 'JÃ¶kulsÃ¡rlÃ³n' }
            ],
            10: [
                { type: 'spot', title: 'é‘½çŸ³æ²™ç˜', desc: 'é»‘æ²™ç˜ä¸Šæ•£è½è‘—å¦‚é‘½çŸ³èˆ¬çš„ç¢å†°ã€‚', query: 'Diamond Beach Iceland' },
                { type: 'hotel', title: 'Fosshotel Glacier Lagoon', desc: 'ä½ç½®æ¥µä½³çš„è¨­è¨ˆé£¯åº—ã€‚', query: 'Fosshotel Glacier Lagoon' }
            ],
            11: [
                { type: 'spot', title: 'Reynisfjara é»‘æ²™ç˜', desc: 'ç„æ­¦å²©ç‰†èˆ‡æµ·ä¸­çŸ³æŸ±ã€‚âš ï¸ æ³¨æ„ç˜‹ç‹—æµªï¼', query: 'Reynisfjara Beach' },
                { type: 'spot', title: 'SkÃ³gafoss å½©è™¹ç€‘å¸ƒ', desc: 'ç™½æ—¥å¤¢å†’éšªç‹æ‹æ”åœ°ï¼Œå¯èµ°åˆ°ç€‘å¸ƒé ‚ç«¯ã€‚', query: 'SkÃ³gafoss' },
                { type: 'spot', title: 'Seljalandsfoss', desc: 'å¯ä»¥èµ°åˆ°ç€‘å¸ƒå¾Œæ–¹çš„æ°´ç°¾æ´ã€‚', query: 'Seljalandsfoss' },
                { type: 'food', title: 'Mia\'s Fish & Chips', desc: 'è·¯é‚Šç´…è‰²é¤è»Šï¼Œå¥½åƒçš„ç‚¸é­šè–¯æ¢ã€‚', query: 'Mia\'s Country Van' }
            ],
            12: [
                { type: 'spot', title: 'Gullfoss é»ƒé‡‘ç€‘å¸ƒ', desc: 'é»ƒé‡‘åœˆæœ€å£¯éº—çš„å…©å±¤å¼ç€‘å¸ƒã€‚', query: 'Gullfoss Falls' },
                { type: 'spot', title: 'Geysir é–“æ­‡æ³‰', desc: 'æ¯å¹¾åˆ†é˜å™´ç™¼ä¸€æ¬¡çš„é«˜ç†±æ°´æŸ±ã€‚', query: 'Geysir Geothermal Area' },
                { type: 'spot', title: 'Ãingvellir åœ‹å®¶å…¬åœ’', desc: 'æ­ç¾æ¿å¡Šäº¤ç•Œè™•ï¼Œäººé¡è­°æœƒç™¼æºåœ°ã€‚', query: 'Thingvellir National Park' }
            ],
            13: [
                { type: 'spot', title: 'Sky Lagoon å¤©ç©ºä¹‹æ¹–', desc: 'è‡¨æµ·çš„ç„¡é‚Šéš›æº«æ³‰ï¼Œå„€å¼æ„Ÿæ»¿åˆ†ã€‚', query: 'Sky Lagoon' },
                { type: 'spot', title: 'Costco åŠ æ²¹/æ¡è²·', desc: 'é‚„è»Šå‰æŠŠæ²¹åŠ æ»¿ï¼Œé †ä¾¿è²·ä¼´æ‰‹ç¦®ã€‚', query: 'Costco Iceland' },
                { type: 'hotel', title: 'å‰å¾€æ©Ÿå ´', desc: 'é‚„è»Šå¾Œå‰å¾€æ©Ÿå ´ï¼Œæº–å‚™æ­æ©Ÿã€‚', query: 'Keflavik Airport Rental Car Return' }
            ]
        };

        // --- 2. é é¢é‚è¼¯ ---

        // åˆå§‹åŒ–
        window.onload = function() {
            renderDayScroller();
            loadDay(2); // é è¨­é¡¯ç¤ºç¬¬äºŒå¤©
            loadExpenses();
        };

        // åˆ‡æ›ä¸»åˆ†é 
        function switchPage(pageId, navEl) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            navEl.classList.add('active');
            window.scrollTo(0,0);
        }

        // æ¸²æŸ“æ—¥æœŸé¸æ“‡å™¨
        function renderDayScroller() {
            const scroller = document.getElementById('day-scroller');
            let html = '';
            for(let i=1; i<=13; i++) {
                html += `<button class="day-btn" id="btn-d${i}" onclick="loadDay(${i})">D${i}</button>`;
            }
            scroller.innerHTML = html;
        }

        // æ™ºæ…§åˆ¤æ–· Emoji å‡½å¼
        function getSmartIcon(item) {
            const text = (item.title + item.desc).toLowerCase();
            if (text.includes('ç€‘å¸ƒ')) return 'ğŸŒŠ';
            if (text.includes('å†°') || text.includes('æ¹–')) return 'ğŸ§Š';
            if (text.includes('æ•™å ‚')) return 'â›ª';
            if (text.includes('æº«æ³‰') || text.includes('lagoon')) return 'â™¨ï¸';
            if (text.includes('ç«å±±') || text.includes('åœ°ç†±') || text.includes('é–“æ­‡æ³‰')) return 'ğŸŒ‹';
            if (text.includes('æ²™ç˜') || text.includes('æµ·')) return 'ğŸ–ï¸';
            if (item.type === 'food') return 'ğŸ´';
            if (item.type === 'hotel') return 'ğŸ›ï¸';
            if (text.includes('æ©Ÿå ´')) return 'âœˆï¸';
            return 'ğŸ”ï¸';
        }

        // è¼‰å…¥ç‰¹å®šæ—¥æœŸçš„åœ–å¡
        function loadDay(day) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-d${day}`).classList.add('active');
            document.getElementById(`btn-d${day}`).scrollIntoView({behavior: "smooth", inline: "center"});

            const list = document.getElementById('itinerary-list');
            const data = itineraryDB[day];
            
            if (!data) {
                list.innerHTML = '<div style="text-align:center; padding:20px; color:#999;">æœ¬æ—¥ç„¡è¡Œç¨‹è³‡æ–™</div>';
                return;
            }

            let cardsHtml = '';
            data.forEach(item => {
                // æ±ºå®šè¦–è¦ºæ¨£å¼
                let visClass = 'vis-spot';
                let tagText = 'ğŸ”ï¸ æ™¯é»';
                
                if(item.type === 'food') { visClass = 'vis-food'; tagText = 'ğŸ´ é¤å»³'; }
                if(item.type === 'hotel') { visClass = 'vis-hotel'; tagText = 'ğŸ›ï¸ ä½å®¿'; }

                const icon = getSmartIcon(item);
                const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.query)}`;

                cardsHtml += `
                    <div class="spot-card">
                        <div class="spot-visual ${visClass}">
                            <div class="spot-tag">${tagText}</div>
                            <span>${icon}</span>
                        </div>
                        <div class="spot-content">
                            <h3 class="spot-title">${item.title}</h3>
                            <div class="spot-desc">${item.desc}</div>
                            <div class="action-row">
                                <a href="${mapLink}" class="btn btn-nav">ğŸ“ å°èˆªå»é€™è£¡</a>
                            </div>
                        </div>
                    </div>
                `;
            });
            list.innerHTML = cardsHtml;
        }

        // --- 3. æºé€šå¡åŠŸèƒ½ ---
        function showFocus(main, sub) {
            document.getElementById('overlay-text-main').innerText = main;
            document.getElementById('overlay-text-sub').innerText = sub;
            document.getElementById('focus-overlay').style.display = 'flex';
        }

        // --- 4. è¨˜å¸³åŠŸèƒ½ ---
        let expenses = [];
        
        function addExpense() {
            const item = document.getElementById('exp-item').value;
            const cost = parseInt(document.getElementById('exp-cost').value);
            if(!item || isNaN(cost)) return alert('è«‹è¼¸å…¥å®Œæ•´è³‡è¨Š');

            expenses.push({item, cost});
            saveAndRenderExp();
            
            document.getElementById('exp-item').value = '';
            document.getElementById('exp-cost').value = '';
        }

        function saveAndRenderExp() {
            localStorage.setItem('iceland_expenses_v2', JSON.stringify(expenses));
            const list = document.getElementById('exp-list');
            let total = 0;
            let html = '';
            
            expenses.forEach((e, i) => {
                total += e.cost;
                html += `<div style="display:flex; justify-content:space-between; padding:5px 0; border-bottom:1px dashed #eee;">
                    <span>${e.item}</span> <span>${e.cost.toLocaleString()}</span>
                </div>`;
            });
            
            list.innerHTML = html;
            document.getElementById('exp-total').innerText = total.toLocaleString();
        }

        function loadExpenses() {
            const saved = localStorage.getItem('iceland_expenses_v2');
            if(saved) {
                expenses = JSON.parse(saved);
                saveAndRenderExp();
            }
        }

        function clearExp() {
            if(confirm('ç¢ºå®šæ¸…é™¤ï¼Ÿ')) {
                expenses = [];
                saveAndRenderExp();
            }
        }
    </script>
</body>
</html>
