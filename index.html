<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å†°å³¶éš¨èº«åŠ©ç† - Iceland 2026</title>
    <style>
        :root {
            --primary: #003897; /* å†°å³¶è— */
            --accent: #d72828;  /* è­¦å‘Šç´… */
            --bg: #f4f7f6;
            --card: #ffffff;
            --text: #333333;
            --safe: #2ecc71;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; overflow-x: hidden; }

        /* åº•éƒ¨å°è¦½åˆ— [cite: 6] */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; height: 70px;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid #ddd; z-index: 1000;
        }
        .nav-item { text-align: center; flex: 1; color: #888; text-decoration: none; font-size: 12px; cursor: pointer; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item i { font-size: 24px; display: block; margin-bottom: 4px; }

        /* å…§å®¹å€å¡Šæ§åˆ¶ [cite: 5] */
        .page { display: none; padding: 20px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* å¡ç‰‡æ¨£å¼ */
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .card h2 { margin-top: 0; font-size: 18px; color: var(--primary); border-bottom: 1px solid #eee; padding-bottom: 8px; }

        /* è­¦ç¤ºè‰²å¡Š [cite: 26] */
        .alert-card { border: 2px solid var(--accent); background: #fff5f5; }

        /* æ±ºç­–æ”¯æ´ A/B/C [cite: 19, 20] */
        .decision-box { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        .option { padding: 8px; border-radius: 6px; font-size: 12px; text-align: center; color: white; }
        .opt-a { background: #5c7cfa; } /* äº«å— */
        .opt-b { background: #51cf66; } /* å®‰å…¨/å‚™ç”¨ */
        .opt-c { background: #fab005; } /* å¿«é€Ÿ */

        /* é€šè¨Šè¼”åŠ© [cite: 15, 16] */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; color: #fff; z-index: 2000; justify-content: center; align-items: center;
            padding: 40px; text-align: center;
        }
        .modal-text { font-size: 48px; font-weight: bold; line-height: 1.2; }
        .modal-subtext { font-size: 20px; color: #aaa; margin-top: 20px; }

        /* è¨˜å¸³æœ¬ [cite: 28, 31] */
        .expense-input { display: flex; gap: 5px; margin-bottom: 10px; }
        .expense-input input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .expense-list { margin-top: 10px; font-size: 14px; }
        .expense-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dashed #eee; }

        /* å¤©æ°£å„€è¡¨æ¿ [cite: 11, 12] */
        .weather-grid { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; }
        .weather-day { min-width: 80px; text-align: center; background: #f0f4f8; padding: 10px; border-radius: 8px; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { display: inline-block; padding: 8px 16px; background: var(--primary); color: white; border-radius: 6px; text-decoration: none; margin: 5px 0; font-size: 14px; }
        .btn-map { background: #4285F4; }
        .btn-call { background: #34A853; }
        .emergency-btn { background: var(--accent); width: 100%; text-align: center; padding: 15px; font-weight: bold; }
    </style>
</head>
<body>

    <section id="page-home" class="page active">
        <div class="card alert-card">
            <h2>ğŸš¨ é‡è¦æé†’ [cite: 26]</h2>
            <p><strong>èˆªç­ï¼š</strong> 9/27 åœ‹éš›èˆªç­å‡ºç™¼ï¼Œå‹™å¿…æå‰ 3 å°æ™‚æŠµé”æ«ƒæª¯ [cite: 42]</p>
            <p><strong>å–è»Šï¼š</strong> 9/28 LOTUS Car Rental (è‡ªåŠ©å–è»Šå¯†ç¢¼åˆ¶) [cite: 46, 49]</p>
        </div>

        <div class="card">
            <h2>ğŸŒ å³æ™‚è³‡è¨Š [cite: 8]</h2>
            <div id="weather-status">å®šä½ä¸­...</div>
            <div class="weather-grid" id="weather-forecast">
                </div>
            <hr>
            <p>ğŸ‡®ğŸ‡¸ <strong>å†°å³¶å…‹æœ—æ›ç®—ï¼š</strong> 1000 ISK â‰ˆ 230 TWD</p>
            <a href="https://safetravel.is" class="btn">æŸ¥çœ‹å†°å³¶æ°£è±¡å®‰å…¨è­¦å‘Š</a>
        </div>

        <div class="card">
            <h2>âœ¨ æ¥µå…‰ç›£æ§ (Aurora Watch)</h2>
            <p>ä»Šæ™šé æ¸¬ï¼š<span id="kp-index">Kp 3 (ä¸€èˆ¬)</span></p>
            <a href="https://en.vedur.is/weather/forecasts/aurora/" class="btn btn-map">æŸ¥çœ‹é›²å±¤è¦†è“‹åœ–</a>
        </div>
        
        <a href="tel:112" class="btn emergency-btn">ğŸ†˜ å†°å³¶ç·Šæ€¥æ±‚åŠ© (112)</a>
    </section>

    <section id="page-itinerary" class="page">
        <div id="day-selector" style="margin-bottom: 15px; display: flex; overflow-x: auto; gap: 5px;">
            </div>
        <div id="itinerary-content">
            </div>
    </section>

    <section id="page-comm" class="page">
        <h2>ğŸ‡®ğŸ‡¸ æºé€šè¼”åŠ© (Icelandic/English)</h2>
        <details class="card">
            <summary>ğŸ¥ é†«ç™‚èˆ‡ç·Šæ€¥ (Emergency)</summary>
            <div onclick="showFocus('Ã‰g Ã¾arf hjÃ¡lp', 'I need help / æˆ‘éœ€è¦å¹«åŠ©')">ğŸ†˜ æˆ‘éœ€è¦å¹«åŠ©</div>
            <div onclick="showFocus('Hvar er spÃ­talinn?', 'Where is the hospital? / é†«é™¢åœ¨å“ªï¼Ÿ')">ğŸ¥ é†«é™¢åœ¨å“ªï¼Ÿ</div>
        </details>
        <details class="card">
            <summary>ğŸ½ï¸ é¤å»³èˆ‡é£²é£Ÿ (Dining)</summary>
            <div onclick="showFocus('Geta Ã©g fengiÃ° matseÃ°ilinn?', 'Can I have the menu? / è«‹çµ¦æˆ‘èœå–®')">ğŸ“‹ è«‹çµ¦æˆ‘èœå–®</div>
            <div onclick="showFocus('Vinsamlegast reikninginn', 'The check, please / çµå¸³')">ğŸ’° çµå¸³</div>
            <div onclick="showFocus('Ã‰g er meÃ° ofnÃ¦mi', 'I have an allergy / æˆ‘æœƒéæ•')">âš ï¸ æˆ‘æœƒéæ•</div>
        </details>
        <details class="card">
            <summary>ğŸš— è‡ªé§•èˆ‡åŠ æ²¹ (Driving)</summary>
            <div onclick="showFocus('DÃ­sel, takk', 'Diesel, please / è«‹åŠ æŸ´æ²¹')">â›½ è«‹åŠ æŸ´æ²¹</div>
            <div onclick="showFocus('BensÃ­n, takk', 'Gasoline, please / è«‹åŠ æ±½æ²¹')">â›½ è«‹åŠ æ±½æ²¹</div>
        </div>
    </section>

    <section id="page-tools" class="page">
        <div class="card">
            <h2>ğŸ’° æ—…éŠè¨˜å¸³ [cite: 28]</h2>
            <div class="expense-input">
                <input type="text" id="exp-name" placeholder="é …ç›®">
                <input type="number" id="exp-amount" placeholder="ISK">
                <button class="btn" onclick="addExpense()">+ æ–°å¢</button>
            </div>
            <div id="expense-total" style="font-weight:bold; color:var(--accent);">ç¸½è¨ˆ: 0 ISK</div>
            <div class="expense-list" id="expense-list"></div>
            <button onclick="clearExpenses()" style="font-size:10px; margin-top:10px; color:gray;">æ¸…é™¤å…¨éƒ¨è³‡æ–™</button>
        </div>

        <div class="card">
            <h2>âœ… å‡ºç™¼å‰æº–å‚™ [cite: 32]</h2>
            <div id="checklist">
                <div><input type="checkbox" id="check1" onchange="saveCheck()"> è­·ç…§/é§•ç…§ (å«è­¯æœ¬)</div>
                <div><input type="checkbox" id="check2" onchange="saveCheck()"> ä¸‹è¼‰ Google Maps é›¢ç·šåœ°åœ–</div>
                <div><input type="checkbox" id="check3" onchange="saveCheck()"> é˜²é¢¨é˜²æ°´è¡£ç‰©èˆ‡ç™»å±±é‹</div>
                <div><input type="checkbox" id="check4" onchange="saveCheck()"> æ³³è£ (æº«æ³‰ç”¨)</div>
            </div>
        </div>
    </section>

    <div id="focus-modal" class="modal" onclick="this.style.display='none'">
        <div>
            <div class="modal-text" id="modal-is"></div>
            <div class="modal-subtext" id="modal-en"></div>
            <p style="margin-top:50px; color:#555;">é»æ“Šç•«é¢ä»»æ„è™•é—œé–‰</p>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="showPage('home')"><i>ğŸ </i>é¦–é </div>
        <div class="nav-item" onclick="showPage('itinerary')"><i>ğŸ“…</i>è¡Œç¨‹</div>
        <div class="nav-item" onclick="showPage('comm')"><i>ğŸ—£ï¸</i>æºé€š</div>
        <div class="nav-item" onclick="showPage('tools')"><i>ğŸ› ï¸</i>å·¥å…·</div>
    </nav>

    <script>
        // --- æ ¸å¿ƒè³‡æ–™æ¶æ§‹ ---
        const itineraryData = {
            1: { title: "9/27 å‡ºç™¼æ—¥", desc: "å°ç£ â†’ å†°å³¶ã€‚å¤œå®¿æ©Ÿä¸Š [cite: 40-43]", lat: 63.985, lon: -22.605 },
            2: { title: "9/28 é›·å…‹é›…ç¶­å…‹", desc: "å–è»Š(LOTUS) â†’ å½©è™¹è¡— â†’ å“ˆçˆ¾æ ¼æ—å§†æ•™å ‚å¤œæ™¯ [cite: 44-46, 63-64]", 
                 abc: { a: "Old Iceland (ç¾Šè‚‰æ¹¯) [cite: 58]", b: "æ¨“ä¸‹æ³°å¼é¤å»³ [cite: 54]", c: "Bonus è¶…å¸‚æ¡è²· [cite: 65]" }, 
                 link: "https://www.google.com/maps/search/?api=1&query=SkÃ³lavÃ¶rÃ°ustÃ­gur+21A" },
            3: { title: "9/29 æ–¯å¥ˆå±±åŠå³¶", desc: "07:00 å‡ºç™¼ â†’ æ–¯å¥ˆå±±åŠå³¶ [cite: 66-67]", 
                 abc: { a: "æ¸¯å£å’–å•¡å»³ [cite: 88]", b: "StÃ¶Ã° Guesthouse è‡ªç…® [cite: 69]", c: "è·¯é‚Šè£œçµ¦ç«™" },
                 link: "https://www.google.com/maps/search/?api=1&query=StÃ¶Ã°+Guesthouse" },
            4: { title: "9/30 ç¶“å…¸æ–¯å¥ˆå±±", desc: "æ•™å ‚å±± â†’ æµ·è±¹æ²™ç˜ â†’ è¥¿éƒ¨ [cite: 71, 85-87]",
                 abc: { a: "Messinn é®®é­šæ–™ç† [cite: 83]", b: "BÃ¦jarins Beztu Pylsur ç†±ç‹— [cite: 81]", c: "è¶…å¸‚å¿«é€Ÿä¸‰æ˜æ²»" },
                 link: "https://www.google.com/maps/search/?api=1&query=Kirkjufell" },
            5: { title: "10/1 å‰é€²åŒ—éƒ¨", desc: "ç†”å²©ç€‘å¸ƒ â†’ é¯¨é­šæ•™å ‚ â†’ SiglufjÃ¶rÃ°ur [cite: 93-96]",
                 link: "https://www.google.com/maps/search/?api=1&query=SiglÃ³+HÃ³tel" },
            6: { title: "10/2 åŒ—éƒ¨ç¶“å…¸", desc: "çœ¾ç¥ç€‘å¸ƒ â†’ ç±³æ¹–æº«æ³‰ â†’ Hverir åœ°ç†±è°· [cite: 101, 104, 107-108]",
                 abc: { a: "ç±³æ¹–æº«æ³‰é¤å»³", b: "Akureyri å¸‚å€é€²é£Ÿ", c: "è»Šä¸Šé‡é¤" },
                 link: "https://www.google.com/maps/search/?api=1&query=MÃ½vatn+Nature+Baths" },
            7: { title: "10/3 æ±éƒ¨å³½ç£", desc: "Dettifoss â†’ ç™½æ—¥å¤¢å†’éšªç‹å°é® SeyÃ°isfjÃ¶rÃ°ur [cite: 112, 116, 119]",
                 link: "https://www.google.com/maps/search/?api=1&query=SeyÃ°isfjÃ¶rÃ°ur" },
            8: { title: "10/4 å†°å·å¥è¡Œ(1)", desc: "SkyrhÃºsid ä½å®¿ â†’ å†°å·å¥è¡Œé å‚™ [cite: 124-126]",
                 link: "https://www.google.com/maps/search/?api=1&query=SkyrhÃºsid+Guesthouse" },
            9: { title: "10/5 è—å†°æ´æ¢éšª", desc: "09:00 Blue Ice Cave Adventure (5-6å°æ™‚) [cite: 129-130]",
                 link: "https://www.google.com/maps/search/?api=1&query=JÃ¶kulsÃ¡rlÃ³n" },
            10: { title: "10/6 å†°æ²³æ¹–èˆ‡å—å²¸", desc: "é‘½çŸ³æ²™ç˜ â†’ æ•™å ‚åŸ â†’ æ¨è–¦ç¾Šæ’æ–™ç† [cite: 132-135, 139]",
                  link: "https://www.google.com/maps/search/?api=1&query=Diamond+Beach+Iceland" },
            11: { title: "10/7 å—å²¸ç€‘å¸ƒç·š", desc: "ç¾½æ¯›å³½è°· â†’ é»‘æ²™ç˜ â†’ å½©è™¹ç€‘å¸ƒ â†’ å¡é‡Œé›…è˜­ç€‘å¸ƒ [cite: 142-147]",
                  abc: { a: "StrÃ¶ndin é­šæ¹¯ [cite: 144]", b: "Mia's Fish & Chips [cite: 146]", c: "Tommi's Burger [cite: 150]" },
                  link: "https://www.google.com/maps/search/?api=1&query=SkÃ³gafoss" },
            12: { title: "10/8 é»ƒé‡‘åœˆ", desc: "é–“æ­‡æ³‰ â†’ é»ƒé‡‘ç€‘å¸ƒ â†’ è­°æœƒåœ‹å®¶å…¬åœ’ [cite: 151, 154-156]",
                  link: "https://www.google.com/maps/search/?api=1&query=Gullfoss" },
            13: { title: "10/9 è—æ¹–/Sky Lagoon", desc: "Sky Lagoon æº«æ³‰ â†’ 20:00 é‚„è»Š â†’ æ©Ÿå ´é£¯åº— [cite: 159-165]",
                  link: "https://www.google.com/maps/search/?api=1&query=Sky+Lagoon" }
        };

        // --- é é¢åˆ‡æ›ç³»çµ± [cite: 4, 5] ---
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(ni => ni.classList.remove('active'));
            event?.currentTarget?.classList.add('active');
            window.scrollTo(0,0); // [cite: 7]
        }

        // --- è¡Œç¨‹ç”Ÿæˆå™¨ ---
        function initItinerary() {
            const selector = document.getElementById('day-selector');
            for(let i=1; i<=13; i++) {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.innerText = `D${i}`;
                btn.onclick = () => renderDay(i);
                selector.appendChild(btn);
            }
            renderDay(2); // é è¨­é¡¯ç¤º D2 (å–è»Šæ—¥)
        }

        function renderDay(day) {
            const data = itineraryData[day];
            let abcHtml = '';
            if(data.abc) { // æ±ºç­–æ”¯æ´ç³»çµ± [cite: 19]
                abcHtml = `
                    <div class="decision-box">
                        <div class="option opt-a">A.äº«å—: ${data.abc.a}</div>
                        <div class="option opt-b">B.ä¿éšª: ${data.abc.b}</div>
                        <div class="option opt-c">C.å¿«é€Ÿ: ${data.abc.c}</div>
                    </div>
                `;
            }
            document.getElementById('itinerary-content').innerHTML = `
                <div class="card">
                    <h2>ç¬¬ ${day} å¤©ï¼š${data.title}</h2>
                    <p>${data.desc}</p>
                    ${abcHtml}
                    <a href="${data.link}" class="btn btn-map">ğŸ“ é–‹å•Ÿ Google Maps å°èˆª </a>
                </div>
            `;
        }

        // --- å¤©æ°£åŠŸèƒ½ [cite: 9, 10, 11] ---
        async function fetchWeather() {
            const status = document.getElementById('weather-status');
            const forecast = document.getElementById('weather-forecast');
            
            // æ¨¡æ“¬å®šä½æˆåŠŸèˆ‡ Fallback æ©Ÿåˆ¶ [cite: 10]
            try {
                status.innerHTML = "ğŸ“ æ­£åœ¨ç²å–é›·å…‹é›…ç¶­å…‹å¤©æ°£...";
                // å¯¦å‹™ä¸Šåœ¨æ­¤èª¿ç”¨ Weather API
                const mockDays = [
                    { day: 'ä»Šå¤©', temp: '4Â°C', emo: 'â˜ï¸' },
                    { day: 'é€±ä¸€', temp: '2Â°C', emo: 'ğŸŒ§ï¸' },
                    { day: 'é€±äºŒ', temp: '3Â°C', emo: 'â˜€ï¸' },
                    { day: 'é€±ä¸‰', temp: '1Â°C', emo: 'ğŸŒ¨ï¸' },
                    { day: 'é€±å››', temp: '5Â°C', emo: 'â˜ï¸' }
                ];
                forecast.innerHTML = mockDays.map(d => `
                    <div class="weather-day">
                        <div>${d.day}</div>
                        <div style="font-size:24px">${d.emo}</div>
                        <div>${d.temp}</div>
                    </div>
                `).join('');
            } catch (e) {
                status.innerHTML = "âš ï¸ ç„¡æ³•ç²å–å³æ™‚å¤©æ°£";
            }
        }

        // --- å…¨è¢å¹•é€šè¨Šå±•ç¤º [cite: 15, 16] ---
        function showFocus(is, en) {
            const modal = document.getElementById('focus-modal');
            document.getElementById('modal-is').innerText = is;
            document.getElementById('modal-en').innerText = en;
            modal.style.display = 'flex';
        }

        // --- è¨˜å¸³èˆ‡è³‡æ–™æŒä¹…åŒ– [cite: 28, 30] ---
        let expenses = JSON.parse(localStorage.getItem('iceland_exp')) || [];
        function addExpense() {
            const name = document.getElementById('exp-name').value;
            const amount = document.getElementById('exp-amount').value;
            if(!name || !amount) return;
            expenses.push({ name, amount: parseInt(amount) });
            updateExpenses();
            document.getElementById('exp-name').value = '';
            document.getElementById('exp-amount').value = '';
        }

        function updateExpenses() {
            const list = document.getElementById('expense-list');
            const total = expenses.reduce((sum, item) => sum + item.amount, 0);
            list.innerHTML = expenses.map(item => `
                <div class="expense-item"><span>${item.name}</span><span>${item.amount.toLocaleString()} ISK</span></div>
            `).join('');
            document.getElementById('expense-total').innerText = `ç¸½è¨ˆ: ${total.toLocaleString()} ISK`;
            localStorage.setItem('iceland_exp', JSON.stringify(expenses));
        }

        function clearExpenses() {
            if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å¸³ç›®å—ï¼Ÿ')) {
                expenses = [];
                updateExpenses();
            }
        }

        // --- æ ¸å–æ¸…å–®æŒä¹…åŒ– [cite: 34] ---
        function saveCheck() {
            const checks = {};
            document.querySelectorAll('#checklist input').forEach((cb, idx) => {
                checks[idx] = cb.checked;
            });
            localStorage.setItem('iceland_checks', JSON.stringify(checks));
        }

        function loadCheck() {
            const checks = JSON.parse(localStorage.getItem('iceland_checks')) || {};
            document.querySelectorAll('#checklist input').forEach((cb, idx) => {
                cb.checked = checks[idx] || false;
            });
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            initItinerary();
            fetchWeather();
            updateExpenses();
            loadCheck();
        };
    </script>
</body>
</html>
